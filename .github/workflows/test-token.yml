name: TEST TOKEN SOLO
on: push
jobs:
  check-token:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar Token con CURL
        run: |
          echo "Probando acceso a ssh.devortega.com..."
          
          # Hacemos una petici√≥n web simulando ser el robot
          CODIGO=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "CF-Access-Client-Id: ${{ secrets.CF_CLIENT_ID }}" \
            -H "CF-Access-Client-Secret: ${{ secrets.CF_CLIENT_SECRET }}" \
            https://ssh.devortega.com)
          
          echo "El servidor respondi√≥ con c√≥digo: $CODIGO"
          
          if [ "$CODIGO" == "200" ]; then
            echo "‚úÖ EL TOKEN FUNCIONA. El problema es cloudflared/SSH."
          elif [ "$CODIGO" == "403" ]; then
             echo "üö´ PROHIBIDO (403). Cloudflare reconoce el token pero NO le da permiso en la Pol√≠tica."
             exit 1
          elif [ "$CODIGO" == "302" ]; then
             echo "u001F‚Ü™ REDIRECCI√ìN (302). Cloudflare NO reconoce el token y te manda al login."
             exit 1
          else
             echo "‚ö†Ô∏è Error extra√±o: $CODIGO"
             exit 1
          fi